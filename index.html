<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="P5js sound examples : some examples  combining p5.js and p5.sound">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>P5js sound examples</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/b2renger/p5js_sound_examples">View on GitHub</a>

          <h1 id="project_title">P5js sound examples</h1>
          <h2 id="project_tagline">some examples  combining p5.js and p5.sound</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/b2renger/p5js_sound_examples/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/b2renger/p5js_sound_examples/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="p5js-sound-examples-with-p5sound" class="anchor" href="#p5js-sound-examples-with-p5sound" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>p5.js sound examples with p5.sound</h1>

<hr>

<p>This repo hosts example of code using p5.js and it's sound library p5.sound :</p>

<ul>
<li><a href="http://p5js.org/">http://p5js.org/</a></li>
<li><a href="http://p5js.org/reference/#/libraries/p5.sound">http://p5js.org/reference/#/libraries/p5.sound</a></li>
</ul>

<p>I also use dat.gui.js for the guis :</p>

<ul>
<li>
<a href="http://workshop.chromeexperiments.com/examples/gui/#1--Basic-Usage">http://workshop.chromeexperiments.com/examples/gui/#1--Basic-Usage</a> </li>
<li><a href="https://code.google.com/p/dat-gui/">https://code.google.com/p/dat-gui/</a></li>
</ul>

<p>Three examples right now :</p>

<h5>
<a id="table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Table of Contents</h5>

<p><a href="#springs">Springs</a><br>
<a href="#flock">Flock</a><br>
<a href="#sidlee">Sid Lee sonification</a></p>

<hr>

<p><a name="springs"></a></p>

<h2>
<a id="springs" class="anchor" href="#springs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Springs</h2>

<hr>

<p><a href="http://b2renger.github.io/pages_p5js/springs/index.html">http://b2renger.github.io/pages_p5js/springs/index.html</a></p>

<p>This example is the sonification of a spring system simulation. </p>

<h3>
<a id="spring-class-to-a-row-of-springs" class="anchor" href="#spring-class-to-a-row-of-springs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>spring class to a row of springs</h3>

<p>First we will take a look at the spring class <em>c_spring.js</em>, it's adapted from this code :</p>

<p><a href="http://processingjs.org/learning/topic/springs/">http://processingjs.org/learning/topic/springs/</a></p>

<p>to fit the p5.js style. We have also blocked the movement on the X axis, commenting line 38 to 43.</p>

<p>So we now want to create a line of 8 springs :</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> springs <span class="pl-k">=</span> [];

<span class="pl-k">function</span> <span class="pl-en">setup</span>() {

  <span class="pl-en">createCanvas</span>(windowWidth, windowHeight);

  <span class="pl-k">for</span> (<span class="pl-k">var</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>; i<span class="pl-k">&lt;</span><span class="pl-c1">8</span>; i<span class="pl-k">++</span>) {
    s1 <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Spring</span>( <span class="pl-c1">50</span><span class="pl-k">+</span> windowWidth<span class="pl-k">*</span>i<span class="pl-k">/</span><span class="pl-c1">8</span>, windowHeight<span class="pl-k">/</span><span class="pl-c1">2</span>,  <span class="pl-c1">20</span>, <span class="pl-c1">0.98</span>, <span class="pl-c1">1.0</span>); <span class="pl-c">// create the spring</span>
    <span class="pl-smi">springs</span>.<span class="pl-c1">push</span>(s1); <span class="pl-c">// put it in the springs array.</span>
  }
}

<span class="pl-k">function</span> <span class="pl-en">draw</span>() {

  <span class="pl-en">background</span>(<span class="pl-c1">0</span>);
  <span class="pl-en">fill</span>(<span class="pl-c1">255</span>);

  <span class="pl-k">for</span> (<span class="pl-k">var</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>; i<span class="pl-k">&lt;</span><span class="pl-smi">springs</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>) {
    springs[i].<span class="pl-en">update</span>();
    springs[i].<span class="pl-c1">display</span>();
  }
}</pre></div>

<h3>
<a id="adding-sound" class="anchor" href="#adding-sound" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>adding sound</h3>

<p>We will implement our audio engine, object oriented style, so each of our spring will have the same sound. We just want to do some basic amplitude modulation. So we need to create an oscillator and control it's volume with the displacement of each spring.</p>

<p>We will agregate this method for our spring class. We simply create a new OScillator, declare a variable to hold its frequency, and start it :</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Spring</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">audio</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(){
  <span class="pl-v">this</span>.<span class="pl-smi">osc</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">p5.SinOsc</span>(); <span class="pl-c">// create a new oscillator</span>

  <span class="pl-v">this</span>.<span class="pl-smi">freq</span> <span class="pl-k">=</span> <span class="pl-en">midiToFreq</span>(<span class="pl-c1">60</span>); <span class="pl-c">// create a variable to hold freq</span>
  <span class="pl-v">this</span>.<span class="pl-smi">osc</span>.<span class="pl-en">freq</span>(<span class="pl-v">this</span>.<span class="pl-smi">freq</span>); <span class="pl-c">// apply freq</span>
  <span class="pl-v">this</span>.<span class="pl-smi">osc</span>.<span class="pl-c1">start</span>(); <span class="pl-c">// start the oscillator</span>
}</pre></div>

<p>Since we are at it we can also create a new method to set the frequency :</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Spring</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">set_note</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">f</span>){
  <span class="pl-v">this</span>.<span class="pl-smi">freq</span> <span class="pl-k">=</span> <span class="pl-en">midiToFreq</span>(f);
  <span class="pl-v">this</span>.<span class="pl-smi">osc</span>.<span class="pl-en">freq</span>(<span class="pl-v">this</span>.<span class="pl-smi">freq</span>);
}</pre></div>

<p>Now we want to create a new method to control the volume of our oscillator. We want to calculate the distance beetween the actual position of the spring and its rest position, then map this distance to a usefull range for controlling audio signal, and apply it :</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Spring</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">audio_update</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(){
  <span class="pl-k">var</span> newamp <span class="pl-k">=</span> <span class="pl-en">constrain</span>(<span class="pl-en">map</span>(<span class="pl-en">abs</span>(<span class="pl-v">this</span>.<span class="pl-smi">positionY</span> <span class="pl-k">-</span> <span class="pl-v">this</span>.<span class="pl-smi">tempPosY</span>),<span class="pl-c1">0</span>,height<span class="pl-k">/</span><span class="pl-c1">2</span>,<span class="pl-c1">0</span>,<span class="pl-c1">1</span>),<span class="pl-c1">0</span>,<span class="pl-c1">0.15</span>);
  <span class="pl-v">this</span>.<span class="pl-smi">osc</span>.<span class="pl-en">amp</span>(newamp,<span class="pl-c1">0.025</span>,<span class="pl-c1">0</span>);
}</pre></div>

<p>Note the use of map() and constrain() to be sure the value stays in a given intervall.
When we apply the new amplitude, we want to use a second parameter to smoothen the changes in the audio level and avoid clicks.</p>

<p>Now in the setup we just need to init sound </p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">for</span> (<span class="pl-k">var</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>; i<span class="pl-k">&lt;</span><span class="pl-c1">8</span>; i<span class="pl-k">++</span>) {
    s1 <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Spring</span>( <span class="pl-c1">50</span><span class="pl-k">+</span> windowWidth<span class="pl-k">*</span>i<span class="pl-k">/</span><span class="pl-c1">8</span>, windowHeight<span class="pl-k">/</span><span class="pl-c1">2</span>,  <span class="pl-c1">20</span>, <span class="pl-c1">0.98</span>, <span class="pl-c1">1.0</span>);
    <span class="pl-smi">s1</span>.<span class="pl-en">audio</span>(); <span class="pl-c">// audio constructor</span>
    <span class="pl-smi">s1</span>.<span class="pl-en">set_note</span>(<span class="pl-c1">60</span> <span class="pl-k">+</span> i); <span class="pl-c">// set different frequencies</span>
    <span class="pl-smi">springs</span>.<span class="pl-c1">push</span>(s1);
}</pre></div>

<p>And in the draw to update sound :</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">for</span> (<span class="pl-k">var</span> i<span class="pl-k">=</span><span class="pl-c1">0</span>; i<span class="pl-k">&lt;</span><span class="pl-smi">springs</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>) {
    springs[i].<span class="pl-en">update</span>();
    springs[i].<span class="pl-en">audio_update</span>(); <span class="pl-c">// call audio update</span>
    springs[i].<span class="pl-c1">display</span>();
}</pre></div>

<h3>
<a id="using-datgui" class="anchor" href="#using-datgui" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using dat.gui</h3>

<p>We gave a link to a dat.gui workshop at the top of the page.
<a href="http://workshop.chromeexperiments.com/examples/gui/#1--Basic-Usage">http://workshop.chromeexperiments.com/examples/gui/#1--Basic-Usage</a> </p>

<p>To sum-up : we create to data-structure to hold our parameters</p>

<ul>
<li>one for the frequency of our oscillators :</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> <span class="pl-en">scaleParameters</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-v">this</span>.<span class="pl-smi">Spring_0</span> <span class="pl-k">=</span> <span class="pl-c1">60</span>;
  <span class="pl-v">this</span>.<span class="pl-smi">Spring_1</span> <span class="pl-k">=</span> <span class="pl-c1">62</span>;
  <span class="pl-v">this</span>.<span class="pl-smi">Spring_2</span> <span class="pl-k">=</span> <span class="pl-c1">63</span>;
  <span class="pl-v">this</span>.<span class="pl-smi">Spring_3</span> <span class="pl-k">=</span> <span class="pl-c1">65</span>;
  <span class="pl-v">this</span>.<span class="pl-smi">Spring_4</span> <span class="pl-k">=</span> <span class="pl-c1">67</span>;
  <span class="pl-v">this</span>.<span class="pl-smi">Spring_5</span> <span class="pl-k">=</span> <span class="pl-c1">68</span>;
  <span class="pl-v">this</span>.<span class="pl-smi">Spring_6</span> <span class="pl-k">=</span> <span class="pl-c1">70</span>;
  <span class="pl-v">this</span>.<span class="pl-smi">Spring_7</span> <span class="pl-k">=</span> <span class="pl-c1">72</span>; 
}</pre></div>

<ul>
<li>one for our simulation parameters :</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> <span class="pl-en">simulationParameters</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(){
  <span class="pl-v">this</span>.<span class="pl-smi">Mass</span> <span class="pl-k">=</span> <span class="pl-c1">1</span> ;
  <span class="pl-v">this</span>.<span class="pl-smi">Damping</span> <span class="pl-k">=</span> <span class="pl-c1">0.90</span> ;
  <span class="pl-v">this</span>.<span class="pl-c1">K</span> <span class="pl-k">=</span> <span class="pl-c1">0.2</span>;
}</pre></div>

<p>And we init the gui with two seperate folders four our sets of parameters :</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> <span class="pl-en">initGui</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
  <span class="pl-k">var</span> f2 <span class="pl-k">=</span> <span class="pl-smi">gui</span>.<span class="pl-en">addFolder</span>(<span class="pl-s"><span class="pl-pds">'</span>Simulation parameters<span class="pl-pds">'</span></span>);
  <span class="pl-smi">f2</span>.<span class="pl-c1">add</span>(sim, <span class="pl-s"><span class="pl-pds">'</span>Mass<span class="pl-pds">'</span></span>,<span class="pl-c1">1</span>,<span class="pl-c1">50</span>);
  <span class="pl-smi">f2</span>.<span class="pl-c1">add</span>(sim, <span class="pl-s"><span class="pl-pds">'</span>Damping<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>,<span class="pl-c1">1</span>);
  <span class="pl-smi">f2</span>.<span class="pl-c1">add</span>(sim, <span class="pl-s"><span class="pl-pds">'</span>K<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>,<span class="pl-c1">1</span>);  

  <span class="pl-k">var</span> f1 <span class="pl-k">=</span> <span class="pl-smi">gui</span>.<span class="pl-en">addFolder</span>(<span class="pl-s"><span class="pl-pds">'</span>Tuning (Midi notes)<span class="pl-pds">'</span></span>);
  <span class="pl-smi">f1</span>.<span class="pl-c1">add</span>(scale, <span class="pl-s"><span class="pl-pds">'</span>Spring_0<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>,<span class="pl-c1">127</span>).<span class="pl-en">listen</span>();
  <span class="pl-smi">f1</span>.<span class="pl-c1">add</span>(scale, <span class="pl-s"><span class="pl-pds">'</span>Spring_1<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>,<span class="pl-c1">127</span>).<span class="pl-en">listen</span>();
  <span class="pl-smi">f1</span>.<span class="pl-c1">add</span>(scale, <span class="pl-s"><span class="pl-pds">'</span>Spring_2<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>,<span class="pl-c1">127</span>).<span class="pl-en">listen</span>();
  <span class="pl-smi">f1</span>.<span class="pl-c1">add</span>(scale, <span class="pl-s"><span class="pl-pds">'</span>Spring_3<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>,<span class="pl-c1">127</span>).<span class="pl-en">listen</span>();
  <span class="pl-smi">f1</span>.<span class="pl-c1">add</span>(scale, <span class="pl-s"><span class="pl-pds">'</span>Spring_4<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>,<span class="pl-c1">127</span>).<span class="pl-en">listen</span>();
  <span class="pl-smi">f1</span>.<span class="pl-c1">add</span>(scale, <span class="pl-s"><span class="pl-pds">'</span>Spring_5<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>,<span class="pl-c1">127</span>).<span class="pl-en">listen</span>();
  <span class="pl-smi">f1</span>.<span class="pl-c1">add</span>(scale, <span class="pl-s"><span class="pl-pds">'</span>Spring_6<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>,<span class="pl-c1">127</span>).<span class="pl-en">listen</span>();
  <span class="pl-smi">f1</span>.<span class="pl-c1">add</span>(scale, <span class="pl-s"><span class="pl-pds">'</span>Spring_7<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>,<span class="pl-c1">127</span>).<span class="pl-en">listen</span>();
}</pre></div>

<p>Now we write the code to update our object to their new parameters :</p>

<ul>
<li>first the simulation parameters we just have to add the following code to the for loop that handles our springs.</li>
</ul>

<div class="highlight highlight-source-js"><pre>springs[i].<span class="pl-en">set_mass</span>(<span class="pl-smi">sim</span>.<span class="pl-smi">Mass</span>);
springs[i].<span class="pl-en">set_damping</span>(<span class="pl-smi">sim</span>.<span class="pl-smi">Damping</span>);
springs[i].<span class="pl-en">set_k</span>(<span class="pl-smi">sim</span>.<span class="pl-c1">K</span>);</pre></div>

<ul>
<li>then a conveniency function to change the frequencies :</li>
</ul>

<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">change_note</span>(){
 springs[<span class="pl-c1">0</span>].<span class="pl-en">set_note</span>(<span class="pl-smi">scale</span>.<span class="pl-smi">Spring_0</span>);
 springs[<span class="pl-c1">1</span>].<span class="pl-en">set_note</span>(<span class="pl-smi">scale</span>.<span class="pl-smi">Spring_1</span>);
 springs[<span class="pl-c1">2</span>].<span class="pl-en">set_note</span>(<span class="pl-smi">scale</span>.<span class="pl-smi">Spring_2</span>);
 springs[<span class="pl-c1">3</span>].<span class="pl-en">set_note</span>(<span class="pl-smi">scale</span>.<span class="pl-smi">Spring_3</span>);
 springs[<span class="pl-c1">4</span>].<span class="pl-en">set_note</span>(<span class="pl-smi">scale</span>.<span class="pl-smi">Spring_4</span>);
 springs[<span class="pl-c1">5</span>].<span class="pl-en">set_note</span>(<span class="pl-smi">scale</span>.<span class="pl-smi">Spring_5</span>);
 springs[<span class="pl-c1">6</span>].<span class="pl-en">set_note</span>(<span class="pl-smi">scale</span>.<span class="pl-smi">Spring_6</span>);
 springs[<span class="pl-c1">7</span>].<span class="pl-en">set_note</span>(<span class="pl-smi">scale</span>.<span class="pl-smi">Spring_7</span>);
}</pre></div>

<p>Don't forget to call it in the draw() loop and you also need to declare and init all those new objects in the setup():</p>

<pre lang="javascript()"><code>  scale = new scaleParameters();
  sim =  new simulationParameters();
  gui = new dat.GUI();
  initGui();
</code></pre>

<h3>
<a id="musical-scales" class="anchor" href="#musical-scales" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Musical Scales</h3>

<p>Now we want to have several scales to tune our system. We use array to store several scales which are by the way just series of intervalls. If you look up the internet you should find these pretty fast.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> major_scale <span class="pl-k">=</span> [<span class="pl-c1">0</span>,<span class="pl-c1">2</span>,<span class="pl-c1">3</span>,<span class="pl-c1">5</span>,<span class="pl-c1">7</span>,<span class="pl-c1">8</span>,<span class="pl-c1">10</span>,<span class="pl-c1">12</span>];
<span class="pl-k">var</span> minor_scale <span class="pl-k">=</span> [<span class="pl-c1">0</span>, <span class="pl-c1">1</span>, <span class="pl-c1">4</span>, <span class="pl-c1">5</span>, <span class="pl-c1">7</span>, <span class="pl-c1">8</span>, <span class="pl-c1">11</span>, <span class="pl-c1">12</span>];
<span class="pl-k">var</span> lydian_dominant <span class="pl-k">=</span> [<span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">4</span>, <span class="pl-c1">6</span>, <span class="pl-c1">7</span>, <span class="pl-c1">9</span>, <span class="pl-c1">10</span>, <span class="pl-c1">12</span>];
<span class="pl-k">var</span> harmonic_minor <span class="pl-k">=</span> [<span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">5</span>, <span class="pl-c1">7</span>, <span class="pl-c1">8</span>, <span class="pl-c1">11</span>, <span class="pl-c1">12</span>];
<span class="pl-k">var</span> chromatic_blues <span class="pl-k">=</span> [<span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>, <span class="pl-c1">5</span>, <span class="pl-c1">6</span>, <span class="pl-c1">7</span>, <span class="pl-c1">9</span>];
<span class="pl-k">var</span> pentatonic <span class="pl-k">=</span> [<span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">4</span>, <span class="pl-c1">7</span>, <span class="pl-c1">9</span>, <span class="pl-c1">12</span>, <span class="pl-c1">14</span>, <span class="pl-c1">16</span>];
<span class="pl-k">var</span> pentatonic_blues <span class="pl-k">=</span> [<span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>, <span class="pl-c1">7</span>, <span class="pl-c1">8</span>, <span class="pl-c1">9</span>, <span class="pl-c1">12</span>];
<span class="pl-k">var</span> whole_tones <span class="pl-k">=</span> [<span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">4</span>, <span class="pl-c1">6</span>, <span class="pl-c1">8</span>, <span class="pl-c1">10</span>, <span class="pl-c1">12</span>, <span class="pl-c1">14</span>];
<span class="pl-k">var</span> diminished <span class="pl-k">=</span> [<span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">5</span>, <span class="pl-c1">6</span>, <span class="pl-c1">8</span>, <span class="pl-c1">9</span>, <span class="pl-c1">11</span>];</pre></div>

<hr>

<p><a name="flock"></a></p>

<h2>
<a id="flock" class="anchor" href="#flock" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Flock</h2>

<hr>

<p>Flock : <a href="http://b2renger.github.io/pages_p5js/flock/index.html">http://b2renger.github.io/pages_p5js/flock/index.html</a></p>

<p>For this example we will try to sonify one of the flocking algorithm of Daniel Shiffman :
<a href="http://p5js.org/learn/examples/Simulate_Flocking.php">http://p5js.org/learn/examples/Simulate_Flocking.php</a></p>

<p>We will use the same approach as preivously, we will implement an object oriented audio engine and each particle will have its own sound. We will also build a gui with dat.gui.</p>

<p>We will work within the boid class first :</p>

<p>We need to proptotype our sound engine : what we want is to prototype a cheap helicopter sound using sound synthesis. When you think about it a helicopter sound wise is nothing more than white noise with amplitude modulation. So if you read the Spring example earlier it's nothing new.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Boid</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">boid_sound_engine</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(){
  <span class="pl-c">// a noise source to be modulated</span>
  <span class="pl-c">// we will use the pan function of noise to place our object in a stereo field</span>
  <span class="pl-v">this</span>.<span class="pl-smi">noise</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">p5.Noise</span>();
  <span class="pl-v">this</span>.<span class="pl-smi">noise</span>.<span class="pl-c1">disconnect</span>();
  <span class="pl-v">this</span>.<span class="pl-smi">noise</span>.<span class="pl-en">amp</span>(<span class="pl-c1">0.05</span>,<span class="pl-c1">2</span>);
  <span class="pl-v">this</span>.<span class="pl-smi">noise</span>.<span class="pl-c1">start</span>();

  <span class="pl-c">// an osc to modulate the noise</span>
  <span class="pl-c">// we will be able to adjust the frequency according to the speed of each object</span>
  <span class="pl-v">this</span>.<span class="pl-smi">osc</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">p5.Oscillator</span>(<span class="pl-s"><span class="pl-pds">'</span>sine<span class="pl-pds">'</span></span>);
  <span class="pl-v">this</span>.<span class="pl-smi">osc</span>.<span class="pl-c1">disconnect</span>();
  <span class="pl-v">this</span>.<span class="pl-smi">osc</span>.<span class="pl-en">amp</span>(<span class="pl-c1">1</span>,<span class="pl-c1">2</span>,<span class="pl-c1">0</span>);
  <span class="pl-v">this</span>.<span class="pl-smi">osc</span>.<span class="pl-en">freq</span>(<span class="pl-en">random</span>(<span class="pl-c1">5</span>,<span class="pl-c1">15</span>));
  <span class="pl-v">this</span>.<span class="pl-smi">osc</span>.<span class="pl-c1">start</span>();

  <span class="pl-c">// let's do the modulation !</span>
  <span class="pl-v">this</span>.<span class="pl-smi">noise</span>.<span class="pl-en">amp</span>(<span class="pl-v">this</span>.<span class="pl-smi">osc</span>,<span class="pl-c1">5</span>,<span class="pl-c1">5</span>);
}
</pre></div>

<p>the frequency given to the oscillator will enable us to give an impression of speed : a small number will be perceived as slow, whether a big as fast. We will use this later on, as we have the speed of each boid in that flocking algorithm and of course we will map it to our sound.</p>

<p>Now we have to think about what parameters we want to be able to hear : for instance we need to place a listener and we will need to know what is the relative position of each boid to . If you listen to a bunch of cars passing next to you, they will move in your auditory field passing from left to right, from close to far, sometimes slowly and sometimes very fast. If a car is behind you the noise you perceive won't be the same as if you face it.</p>

<p>So having thought a bit about it we want to be able to make some crude spatialisation for our sounds (left, right, in front of you, behind), we will also want to have some kind of doppler effect :</p>

<p><a href="http://en.wikipedia.org/wiki/Doppler_effect">http://en.wikipedia.org/wiki/Doppler_effect</a></p>

<p>For the spatialisation we will use the pan() method in the next part, for the doppler effect and the mask effect of your head we will use filters and bandpass for doppler et and a low pass for masking :</p>

<div class="highlight highlight-source-js"><pre>  <span class="pl-c">// now we need a filter, we will adjust it's parameters according to our simulation</span>
  <span class="pl-c">// cutoff, and quality for a simulation of a doppler effect</span>
  <span class="pl-v">this</span>.<span class="pl-smi">filter</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">p5.BandPass</span>();
  <span class="pl-v">this</span>.<span class="pl-smi">filter</span>.<span class="pl-c1">disconnect</span>();
  <span class="pl-v">this</span>.<span class="pl-smi">filter</span>.<span class="pl-c1">set</span>(<span class="pl-c1">500</span>,<span class="pl-c1">2</span>);

  <span class="pl-c">// connect our noise to our filter</span>
  <span class="pl-v">this</span>.<span class="pl-smi">noise</span>.<span class="pl-en">connect</span>(<span class="pl-v">this</span>.<span class="pl-smi">filter</span>);

  <span class="pl-c">// we will need another low pass filter :for the head </span>
  <span class="pl-v">this</span>.<span class="pl-smi">lp</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">p5.LowPass</span>();
  <span class="pl-v">this</span>.<span class="pl-smi">lp</span>.<span class="pl-en">freq</span>(<span class="pl-c1">2000</span>);

  <span class="pl-v">this</span>.<span class="pl-smi">filter</span>.<span class="pl-en">connect</span>(<span class="pl-v">this</span>.<span class="pl-smi">lp</span>);
</pre></div>

<p>we also want to add a few helper functions to set things:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Boid</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">s_setGain</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">value</span>){
    <span class="pl-v">this</span>.<span class="pl-smi">filter</span>.<span class="pl-en">amp</span>(value);
}

<span class="pl-smi">Boid</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">s_doppler</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">value</span>){
    <span class="pl-v">this</span>.<span class="pl-smi">filter</span>.<span class="pl-c1">set</span>(value,<span class="pl-c1">2</span>);
}

<span class="pl-smi">Boid</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">s_pan</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">value</span>){
  <span class="pl-v">this</span>.<span class="pl-smi">noise</span>.<span class="pl-en">pan</span>(value);
}

<span class="pl-smi">Boid</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">s_lp</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">value</span>){
    <span class="pl-v">this</span>.<span class="pl-smi">lp</span>.<span class="pl-en">freq</span>(value);
}
</pre></div>

<p>First the speed, because it's easy enough. The veocity of each boid is stored in a variable <em>this.velocity</em> so we can calculate its magnitude with the .mag() method. So we basically just have to map it !</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Boid</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">s_adjustSpeed</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(){
    <span class="pl-v">this</span>.<span class="pl-smi">osc</span>.<span class="pl-en">freq</span>(<span class="pl-en">map</span>(<span class="pl-v">this</span>.<span class="pl-smi">velocity</span>.<span class="pl-en">mag</span>(),<span class="pl-c1">0.5</span>,<span class="pl-c1">5</span>,<span class="pl-c1">5</span>,<span class="pl-c1">10</span>));
}</pre></div>

<p>Now we need to compute all our parameters taking into account the position of the listener and the position of the boid. Our listener will be the mouse postion facing up-screen. We will use a variable for the audibility threshold <em>sp.treshold</em> (it's part of our gui so it's part of a data strucure share by our programm and dat.GUI, sp stands for simulation parameters in the setup). If a boid is nearer than this treshold then we need to compute it's paramters, else its volume is null.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Flock</span>.<span class="pl-c1">prototype</span>.<span class="pl-en">update_audio</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(){
  <span class="pl-c">// take the distance beetween mouse and every object, and adjust amp, filter (doppler effect) and pan</span>
  <span class="pl-c">// we will also take into account the mask effect created by the head with a low pass filter</span>
  <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-v">this</span>.<span class="pl-smi">boids</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>) {
    <span class="pl-k">var</span> distance <span class="pl-k">=</span> <span class="pl-en">dist</span>(mouseX,mouseY,<span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-smi">position</span>.<span class="pl-c1">x</span>, <span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-smi">position</span>.<span class="pl-c1">y</span>);

    <span class="pl-k">if</span> (distance <span class="pl-k">&lt;</span> <span class="pl-smi">sp</span>.<span class="pl-smi">threshold</span>){
      <span class="pl-c">// first we draw a line for each boid we should hear</span>
      <span class="pl-en">stroke</span>(<span class="pl-c1">0</span>);
      <span class="pl-en">line</span>(mouseX,mouseY,<span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-smi">position</span>.<span class="pl-c1">x</span>, <span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-smi">position</span>.<span class="pl-c1">y</span>);

      <span class="pl-c">// set global volume according to distance</span>
      <span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-en">s_setGain</span>(<span class="pl-en">map</span>(distance,<span class="pl-c1">0</span>,<span class="pl-c1">250</span>,<span class="pl-c1">1</span>,<span class="pl-c1">0</span>));
      <span class="pl-c">// same for the frequency of the filter to simulate doppler effect</span>
      <span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-en">s_doppler</span>(<span class="pl-en">map</span>(distance,<span class="pl-c1">0</span>,<span class="pl-c1">250</span>,<span class="pl-c1">1000</span>,<span class="pl-c1">500</span>));

      <span class="pl-c">// now we need to calculate an angle to deal with the panoramic</span>
      <span class="pl-k">var</span> mouse <span class="pl-k">=</span> <span class="pl-en">createVector</span>(mouseX,mouseY);
      <span class="pl-k">var</span> temp <span class="pl-k">=</span> <span class="pl-smi">mouse</span>.<span class="pl-c1">sub</span>(<span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-smi">position</span>);
      <span class="pl-k">var</span> angle <span class="pl-k">=</span> <span class="pl-smi">temp</span>.<span class="pl-en">heading</span>();
      <span class="pl-k">var</span> pan_value <span class="pl-k">=</span> <span class="pl-en">map</span>(<span class="pl-en">abs</span>(angle),<span class="pl-c1">0</span>,<span class="pl-c1">PI</span>,<span class="pl-k">-</span><span class="pl-c1">1</span>,<span class="pl-c1">1</span>); <span class="pl-c">// we don't care if the boid is in front or behind we will do it later</span>
      <span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-en">s_pan</span>(pan_value);

      <span class="pl-c">// deal with the masking effect of our head adjusting a low pass</span>
      <span class="pl-k">var</span> mask <span class="pl-k">=</span> <span class="pl-c1">0</span>;
       <span class="pl-k">if</span> (angle<span class="pl-k">&lt;</span><span class="pl-c1">0</span>){
        mask <span class="pl-k">=</span> <span class="pl-c1">1000</span>;
       }
       <span class="pl-k">else</span>{
        mask <span class="pl-k">=</span> <span class="pl-c1">2500</span>;
       }
       <span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-en">s_lp</span>(mask);
       <span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-smi">lp</span>.<span class="pl-en">res</span>((<span class="pl-c1">250</span><span class="pl-k">-</span>distance)<span class="pl-k">/</span><span class="pl-c1">200</span>); <span class="pl-c">// resonance gets stronger when closer !</span>

      <span class="pl-c">// adjust the frequency of the noise modulation to the actual object speed </span>
      <span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-en">s_adjustSpeed</span>();
    }
    <span class="pl-k">else</span>{
      <span class="pl-v">this</span>.<span class="pl-smi">boids</span>[i].<span class="pl-en">s_setGain</span>(<span class="pl-c1">0</span>); <span class="pl-c">// just to be sure ...</span>
    }

  }

}</pre></div>

<hr>

<p><a name="sidlee"></a></p>

<h2>
<a id="sid-lee" class="anchor" href="#sid-lee" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sid Lee</h2>

<hr>

<p>Sid_lee_sonification : <a href="http://b2renger.github.io/pages_p5js/sidlee-sonification/index.html">http://b2renger.github.io/pages_p5js/sidlee-sonification/index.html</a></p>

<p>This example will use socket.io to connect to a live API delivering sensor data about Sid Lee's office in Paris.</p>

<p>So you should hear it along this visual : <a href="https://sidlee.herokuapp.com/">https://sidlee.herokuapp.com/</a></p>

<p>And here's the api I used : <a href="https://github.com/SidLeeParis/sidLeeAgenceConnectee">https://github.com/SidLeeParis/sidLeeAgenceConnectee</a>
and also a js fiddle from Xavier (the guy behind all the arduino stuff and the node server - <a href="https://github.com/xseignard">https://github.com/xseignard</a>) to understand how to use the code : <a href="http://jsfiddle.net/07acad0b/4/">http://jsfiddle.net/07acad0b/4/</a></p>

<p>I need also to give credit to the samples as many sounds come from freesound.org. Thank you to : robinhood76, noisecollector, maj061785, localtalkradio, kyodon, toiletrolltube, mrauralization, ashleyxxpiano, jackjames-tomknevitt, timbre, rivernile7, stevious42.</p>

<h3>
<a id="get-the-data" class="anchor" href="#get-the-data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get the data</h3>

<p>First notice the two new js files : <em>sidlee-client.js</em> and <em>socket.io.js</em> those are used in js fiddle above to be able to connect to the api and get some data. So we declare and init a client, that will fire up the <em>update_values</em> function at the bottom of the code.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> client <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">SidLeeClient</span>(<span class="pl-s"><span class="pl-pds">'</span>https://sidlee.herokuapp.com/<span class="pl-pds">'</span></span>, update_values);</pre></div>

<p>This <em>update_values</em> function is a parser of event, the client will pass data formated in JSON to our function. Each JSON packet as a field named <strong>._id</strong> we will use it to build an if statement to play sounds, adjust parameters etc.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">update_values</span>(<span class="pl-smi">data</span>){
  <span class="pl-k">var</span> datas <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.<span class="pl-en">stringify</span>(data);
  datas <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.<span class="pl-c1">parse</span>(datas);

  <span class="pl-k">var</span> eventID <span class="pl-k">=</span> <span class="pl-smi">datas</span>.<span class="pl-smi">_id</span>; <span class="pl-c">// the id</span>
  <span class="pl-k">var</span> eventDate <span class="pl-k">=</span> <span class="pl-smi">datas</span>.<span class="pl-smi">date</span>; <span class="pl-c">// we can get the date</span>
  <span class="pl-k">var</span> eventValue <span class="pl-k">=</span> <span class="pl-smi">datas</span>.<span class="pl-c1">value</span>; <span class="pl-c">// the value</span>
  <span class="pl-k">var</span> eventUnit <span class="pl-k">=</span> <span class="pl-smi">datas</span>.<span class="pl-smi">unit</span>; <span class="pl-c">//and the unit of the value</span>

  <span class="pl-k">if</span> (eventID <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>sound<span class="pl-pds">'</span></span>){
    <span class="pl-c">// do something if the event caught is identifyied as the sound sensor  </span>
  }
}</pre></div>

<p>Earlier I said 'each', but in fact one event has no id : it's about the ctrl+z event produce by the several apps people from sid lee are using. Here's the format of the object passed.</p>

<pre><code>Object {date: "2015-02-18T16:44:08.562Z", value: 1, unit: "u", app: "InDesign", user: "Antoine"…}
</code></pre>

<p>So to catch it we just assume that if a JSON object passed has no <em>_id</em> field it's a 'ctrl+z' event.</p>

<h3>
<a id="making-sound" class="anchor" href="#making-sound" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>making sound</h3>

<p>We have a lot of data : fridge door opening, opening of the main door, water stirred from the water dispenser etc. all those event are ponctual they happen once and won't happen again before a certain amount of time. We can use samples for those, when an event is caught the corresponding sound is played !</p>

<p>First we need to preload the samples, it's best :</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> fridgeSound;

<span class="pl-k">function</span> <span class="pl-en">preload</span>(){
  <span class="pl-en">soundFormats</span>(<span class="pl-s"><span class="pl-pds">'</span>ogg<span class="pl-pds">'</span></span>); 
  fridgeSound <span class="pl-k">=</span> <span class="pl-en">loadSound</span>(<span class="pl-s"><span class="pl-pds">'</span>sounds/118435__localtalkradio__fridgeopen_sel.ogg<span class="pl-pds">'</span></span>);
}</pre></div>

<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">update_values</span>(<span class="pl-smi">data</span>){

  <span class="pl-k">var</span> datas <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.<span class="pl-en">stringify</span>(data);
  datas <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.<span class="pl-c1">parse</span>(datas);

  <span class="pl-k">if</span> (<span class="pl-smi">data</span>.<span class="pl-smi">_id</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>fridge<span class="pl-pds">'</span></span>){
    <span class="pl-smi">fridgeSound</span>.<span class="pl-c1">play</span>();
  }</pre></div>

<p>But that not all, we also get sensor data about ambient sound level in the office, electric consumption of the whole office, and ambient light level. For the sound level and the electric consumption we will use samples played in loop mode, and we will add a filter which frequency will be mapped to the light level.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> officeSound;
<span class="pl-k">var</span> electricSound;
<span class="pl-k">var</span> filter;

<span class="pl-k">var</span> lightValue;
<span class="pl-k">var</span> officeValue;
<span class="pl-k">var</span> wattValue;

<span class="pl-k">function</span> <span class="pl-en">preload</span>(){
  <span class="pl-en">soundFormats</span>(<span class="pl-s"><span class="pl-pds">'</span>ogg<span class="pl-pds">'</span></span>); 
  officeSound <span class="pl-k">=</span> <span class="pl-en">loadSound</span>(<span class="pl-s"><span class="pl-pds">'</span>sounds/259632__stevious42__office-background-1.ogg<span class="pl-pds">'</span></span>);
  electricSound <span class="pl-k">=</span> <span class="pl-en">loadSound</span>(<span class="pl-s"><span class="pl-pds">'</span>sounds/187931__mrauralization__electric-humming-sound.wav<span class="pl-pds">'</span></span>);
}</pre></div>

<p>In the setup() function, we create and connect our filter :</p>

<div class="highlight highlight-source-js"><pre>  filter <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">p5.BandPass</span>();
  <span class="pl-smi">officeSound</span>.<span class="pl-c1">disconnect</span>();
  <span class="pl-smi">officeSound</span>.<span class="pl-en">connect</span>(filter);

  <span class="pl-smi">electricSound</span>.<span class="pl-c1">disconnect</span>();
  <span class="pl-smi">electricSound</span>.<span class="pl-en">connect</span>(filter);

  <span class="pl-smi">officeSound</span>.<span class="pl-en">loop</span>();
  <span class="pl-smi">electricSound</span>.<span class="pl-en">loop</span>();</pre></div>

<p>And we adjust parameters in the draw()</p>

<div class="highlight highlight-source-js"><pre>  <span class="pl-k">var</span> vol <span class="pl-k">=</span> <span class="pl-en">int</span>(<span class="pl-en">map</span>(soundValue,<span class="pl-c1">30</span>,<span class="pl-c1">80</span>,<span class="pl-c1">50</span>,<span class="pl-c1">100</span>));
  <span class="pl-smi">officeSound</span>.<span class="pl-en">setVolume</span>(vol<span class="pl-k">/</span><span class="pl-c1">100</span>,<span class="pl-c1">0.15</span>,<span class="pl-c1">0</span>);

  <span class="pl-k">var</span> volE <span class="pl-k">=</span> <span class="pl-en">constrain</span>(<span class="pl-en">int</span>(<span class="pl-en">map</span>(wattValue,<span class="pl-c1">10000</span>,<span class="pl-c1">100000</span>,<span class="pl-c1">20</span>,<span class="pl-c1">100</span>)),<span class="pl-c1">20</span>,<span class="pl-c1">100</span>);
  <span class="pl-smi">electricSound</span>.<span class="pl-en">setVolume</span>(volE<span class="pl-k">/</span><span class="pl-c1">100</span>,<span class="pl-c1">0.15</span>,<span class="pl-c1">0</span>);

  <span class="pl-k">var</span> filterFreq <span class="pl-k">=</span> <span class="pl-en">int</span>(<span class="pl-en">map</span>(lightValue,<span class="pl-c1">0</span>,<span class="pl-c1">40</span>,<span class="pl-c1">800</span>,<span class="pl-c1">2000</span>));
  <span class="pl-smi">filter</span>.<span class="pl-en">freq</span>(filterFreq);
  <span class="pl-smi">filter</span>.<span class="pl-en">res</span>(<span class="pl-c1">2</span>);
</pre></div>

<h3>
<a id="the-vizualisation" class="anchor" href="#the-vizualisation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>the vizualisation</h3>

<p>Well it's all here :</p>

<ul>
<li>waveform visualisation : <a href="http://p5js.org/learn/examples/Sound_Oscillator_Frequency.php">http://p5js.org/learn/examples/Sound_Oscillator_Frequency.php</a>
</li>
<li>spectrum visualisation : <a href="http://p5js.org/learn/examples/Sound_Frequency_Spectrum.php">http://p5js.org/learn/examples/Sound_Frequency_Spectrum.php</a>
</li>
</ul>

<p>We just switch beetween them according to the <em>lightswitch</em> data while inverting the colors.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">P5js sound examples maintained by <a href="https://github.com/b2renger">b2renger</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
